<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FIRM Client Wrapper Test</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #101010;
        color: #f5f5f5;
        margin: 2rem;
      }
      button {
        background: #1e90ff;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
        cursor: pointer;
      }
      button:hover {
        background: #187bcd;
      }
      pre {
        background: #181818;
        padding: 1rem;
        border-radius: 6px;
        max-height: 60vh;
        overflow-y: auto;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>FIRM Client Wrapper Test</h1>
    <button id="connect">Connect</button>
    <pre id="output">Waiting for connection...</pre>

    <script type="module">
      import { FirmSerial } from "./dist/FirmSerial.js";

      const btn = document.getElementById("connect");
      const output = document.getElementById("output");

      function log(msg) {
        console.log(msg);
        output.textContent += "\n" + msg;
      }

      btn.addEventListener("click", async () => {
        log("[UI] Connect clicked");

        try {
          const dev = await FirmSerial.connect({ baudRate: 115200 });
          log("[UI] Connected. Waiting for packets...");

          for await (const pkt of dev.packets()) {
            log("[UI] Packet:\n" + JSON.stringify(pkt, null, 2));
          }

          log("[UI] Stream ended.");
        } catch (err) {
          console.error(err);
          output.textContent += "\nError: " + err;
        }
      });

      log("[UI] Script loaded; handler attached");
      log("[UI] navigator.serial present? " + ("serial" in navigator));
    </script>
  </body>
</html>
